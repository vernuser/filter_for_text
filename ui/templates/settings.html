{% extends "base.html" %}

{% block title %}系统设置 - 网络内容安全过滤系统{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <!-- 页面标题 -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-cog text-white text-lg"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h1 class="text-2xl font-bold text-gray-900">系统设置</h1>
                        <p class="text-sm text-gray-500">配置系统参数和功能选项</p>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button onclick="saveAllSettings()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200">
                        <i class="fas fa-save mr-2"></i>
                        保存设置
                    </button>
                    <button onclick="resetToDefaults()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200">
                        <i class="fas fa-undo mr-2"></i>
                        恢复默认
                    </button>
                    <button onclick="exportSettings()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200">
                        <i class="fas fa-download mr-2"></i>
                        导出配置
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- 设置导航 -->
            <div class="lg:w-1/4">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-600">
                        <h3 class="text-lg font-semibold text-white">设置分类</h3>
                    </div>
                    <nav class="p-2">
                        <a href="#general" onclick="showSettingsTab('general')" class="settings-nav-item active flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-cog mr-3 text-blue-500"></i>
                            常规设置
                        </a>
                        <a href="#filter" onclick="showSettingsTab('filter')" class="settings-nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-filter mr-3 text-green-500"></i>
                            过滤设置
                        </a>
                        <a href="#security" onclick="showSettingsTab('security')" class="settings-nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-shield-alt mr-3 text-red-500"></i>
                            安全设置
                        </a>
                        <a href="#time" onclick="showSettingsTab('time')" class="settings-nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-clock mr-3 text-purple-500"></i>
                            时间控制
                        </a>
                        <a href="#ml" onclick="showSettingsTab('ml')" class="settings-nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-brain mr-3 text-pink-500"></i>
                            机器学习
                        </a>
                        <a href="#notification" onclick="showSettingsTab('notification')" class="settings-nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-bell mr-3 text-yellow-500"></i>
                            通知设置
                        </a>
                        <a href="#system" onclick="showSettingsTab('system')" class="settings-nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-server mr-3 text-indigo-500"></i>
                            系统设置
                        </a>
                        <a href="#backup" onclick="showSettingsTab('backup')" class="settings-nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg mb-1 transition-colors duration-200">
                            <i class="fas fa-database mr-3 text-gray-500"></i>
                            备份恢复
                        </a>
                    </nav>
                </div>
            </div>

            <!-- 设置内容 -->
            <div class="lg:w-3/4">
                <!-- 常规设置 -->
                <div id="general-tab" class="settings-tab">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-600">
                            <h3 class="text-lg font-semibold text-white">常规设置</h3>
                        </div>
                        <div class="p-6">
                            <form id="general-settings-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">系统名称</label>
                                        <input type="text" name="system_name" value="{{ settings.system_name or '网络内容安全过滤系统' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">管理员邮箱</label>
                                        <input type="email" name="admin_email" value="{{ settings.admin_email or '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">默认语言</label>
                                        <select name="default_language" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="zh-CN" {{ 'selected' if settings.default_language == 'zh-CN' else '' }}>简体中文</option>
                                            <option value="en-US" {{ 'selected' if settings.default_language == 'en-US' else '' }}>English</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">时区</label>
                                        <select name="timezone" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="Asia/Shanghai" {{ 'selected' if settings.timezone == 'Asia/Shanghai' else '' }}>北京时间 (UTC+8)</option>
                                            <option value="UTC" {{ 'selected' if settings.timezone == 'UTC' else '' }}>UTC</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">日志级别</label>
                                    <select name="log_level" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="DEBUG" {{ 'selected' if settings.log_level == 'DEBUG' else '' }}>调试 (DEBUG)</option>
                                        <option value="INFO" {{ 'selected' if settings.log_level == 'INFO' else '' }}>信息 (INFO)</option>
                                        <option value="WARNING" {{ 'selected' if settings.log_level == 'WARNING' else '' }}>警告 (WARNING)</option>
                                        <option value="ERROR" {{ 'selected' if settings.log_level == 'ERROR' else '' }}>错误 (ERROR)</option>
                                    </select>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="flex items-center">
                                        <input type="checkbox" name="auto_start" {{ 'checked' if settings.auto_start else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">开机自动启动</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="minimize_to_tray" {{ 'checked' if settings.minimize_to_tray else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">最小化到系统托盘</label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 过滤设置 -->
                <div id="filter-tab" class="settings-tab hidden">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-green-500 to-blue-600">
                            <h3 class="text-lg font-semibold text-white">过滤设置</h3>
                        </div>
                        <div class="p-6">
                            <form id="filter-settings-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="text-lg font-medium text-gray-900 mb-4">Web过滤</h4>
                                        <div class="space-y-3">
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm text-gray-700">启用Web过滤</span>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" name="web_filter_enabled" {{ 'checked' if settings.web_filter_enabled else '' }} class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                </label>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">过滤强度</label>
                                                <select name="web_filter_level" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                                    <option value="low" {{ 'selected' if settings.web_filter_level == 'low' else '' }}>低</option>
                                                    <option value="medium" {{ 'selected' if settings.web_filter_level == 'medium' else '' }}>中</option>
                                                    <option value="high" {{ 'selected' if settings.web_filter_level == 'high' else '' }}>高</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="text-lg font-medium text-gray-900 mb-4">文件过滤</h4>
                                        <div class="space-y-3">
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm text-gray-700">启用文件过滤</span>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" name="file_filter_enabled" {{ 'checked' if settings.file_filter_enabled else '' }} class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                </label>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">最大文件大小 (MB)</label>
                                                <input type="number" name="max_file_size" value="{{ settings.max_file_size or 100 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="text-lg font-medium text-gray-900 mb-4">文本过滤</h4>
                                        <div class="space-y-3">
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm text-gray-700">启用文本过滤</span>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" name="text_filter_enabled" {{ 'checked' if settings.text_filter_enabled else '' }} class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                </label>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm text-gray-700">敏感词检测</span>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" name="sensitive_word_detection" {{ 'checked' if settings.sensitive_word_detection else '' }} class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 安全设置 -->
                <div id="security-tab" class="settings-tab hidden">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-red-500 to-pink-600">
                            <h3 class="text-lg font-semibold text-white">安全设置</h3>
                        </div>
                        <div class="p-6">
                            <form id="security-settings-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">密码策略</label>
                                        <select name="password_policy" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="weak" {{ 'selected' if settings.password_policy == 'weak' else '' }}>弱</option>
                                            <option value="medium" {{ 'selected' if settings.password_policy == 'medium' else '' }}>中</option>
                                            <option value="strong" {{ 'selected' if settings.password_policy == 'strong' else '' }}>强</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">会话超时 (分钟)</label>
                                        <input type="number" name="session_timeout" value="{{ settings.session_timeout or 30 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="flex items-center">
                                        <input type="checkbox" name="two_factor_auth" {{ 'checked' if settings.two_factor_auth else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">启用双因素认证</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="login_attempts_limit" {{ 'checked' if settings.login_attempts_limit else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">限制登录尝试次数</label>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">IP白名单</label>
                                    <textarea name="ip_whitelist" rows="4" placeholder="每行一个IP地址或IP段" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">{{ settings.ip_whitelist or '' }}</textarea>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 时间控制 -->
                <div id="time-tab" class="settings-tab hidden">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-purple-500 to-indigo-600">
                            <h3 class="text-lg font-semibold text-white">时间控制</h3>
                        </div>
                        <div class="p-6">
                            <form id="time-settings-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">工作时间开始</label>
                                        <input type="time" name="work_start_time" value="{{ settings.work_start_time or '09:00' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">工作时间结束</label>
                                        <input type="time" name="work_end_time" value="{{ settings.work_end_time or '18:00' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">工作日</label>
                                    <div class="grid grid-cols-7 gap-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" name="work_days" value="1" {{ 'checked' if '1' in (settings.work_days or '1,2,3,4,5').split(',') else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                            <span class="ml-1 text-sm text-gray-900">周一</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="work_days" value="2" {{ 'checked' if '2' in (settings.work_days or '1,2,3,4,5').split(',') else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                            <span class="ml-1 text-sm text-gray-900">周二</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="work_days" value="3" {{ 'checked' if '3' in (settings.work_days or '1,2,3,4,5').split(',') else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                            <span class="ml-1 text-sm text-gray-900">周三</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="work_days" value="4" {{ 'checked' if '4' in (settings.work_days or '1,2,3,4,5').split(',') else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                            <span class="ml-1 text-sm text-gray-900">周四</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="work_days" value="5" {{ 'checked' if '5' in (settings.work_days or '1,2,3,4,5').split(',') else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                            <span class="ml-1 text-sm text-gray-900">周五</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="work_days" value="6" {{ 'checked' if '6' in (settings.work_days or '').split(',') else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                            <span class="ml-1 text-sm text-gray-900">周六</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="work_days" value="7" {{ 'checked' if '7' in (settings.work_days or '').split(',') else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                            <span class="ml-1 text-sm text-gray-900">周日</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="flex items-center">
                                    <input type="checkbox" name="strict_time_control" {{ 'checked' if settings.strict_time_control else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                    <label class="ml-2 block text-sm text-gray-900">严格时间控制（非工作时间完全禁止访问）</label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 机器学习 -->
                <div id="ml-tab" class="settings-tab hidden">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-pink-500 to-purple-600">
                            <h3 class="text-lg font-semibold text-white">机器学习</h3>
                        </div>
                        <div class="p-6">
                            <form id="ml-settings-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="flex items-center">
                                        <input type="checkbox" name="ml_enabled" {{ 'checked' if settings.ml_enabled else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">启用机器学习</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="auto_training" {{ 'checked' if settings.auto_training else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">自动训练模型</label>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">训练频率</label>
                                        <select name="training_frequency" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="daily" {{ 'selected' if settings.training_frequency == 'daily' else '' }}>每日</option>
                                            <option value="weekly" {{ 'selected' if settings.training_frequency == 'weekly' else '' }}>每周</option>
                                            <option value="monthly" {{ 'selected' if settings.training_frequency == 'monthly' else '' }}>每月</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">模型精度</label>
                                        <select name="model_accuracy" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="low" {{ 'selected' if settings.model_accuracy == 'low' else '' }}>低（快速）</option>
                                            <option value="medium" {{ 'selected' if settings.model_accuracy == 'medium' else '' }}>中（平衡）</option>
                                            <option value="high" {{ 'selected' if settings.model_accuracy == 'high' else '' }}>高（精确）</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">训练数据保留期 (天)</label>
                                    <input type="number" name="data_retention_days" value="{{ settings.data_retention_days or 90 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 通知设置 -->
                <div id="notification-tab" class="settings-tab hidden">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-yellow-500 to-orange-600">
                            <h3 class="text-lg font-semibold text-white">通知设置</h3>
                        </div>
                        <div class="p-6">
                            <form id="notification-settings-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="flex items-center">
                                        <input type="checkbox" name="email_notifications" {{ 'checked' if settings.email_notifications else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">邮件通知</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="desktop_notifications" {{ 'checked' if settings.desktop_notifications else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">桌面通知</label>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">SMTP服务器</label>
                                    <input type="text" name="smtp_server" value="{{ settings.smtp_server or '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">SMTP端口</label>
                                        <input type="number" name="smtp_port" value="{{ settings.smtp_port or 587 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="smtp_ssl" {{ 'checked' if settings.smtp_ssl else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label class="ml-2 block text-sm text-gray-900">使用SSL</label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 系统设置 -->
                <div id="system-tab" class="settings-tab hidden">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-indigo-500 to-blue-600">
                            <h3 class="text-lg font-semibold text-white">系统设置</h3>
                        </div>
                        <div class="p-6">
                            <form id="system-settings-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">最大并发连接数</label>
                                        <input type="number" name="max_connections" value="{{ settings.max_connections or 1000 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">缓存大小 (MB)</label>
                                        <input type="number" name="cache_size" value="{{ settings.cache_size or 512 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">日志保留期 (天)</label>
                                        <input type="number" name="log_retention_days" value="{{ settings.log_retention_days or 30 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">数据库清理频率</label>
                                        <select name="db_cleanup_frequency" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="daily" {{ 'selected' if settings.db_cleanup_frequency == 'daily' else '' }}>每日</option>
                                            <option value="weekly" {{ 'selected' if settings.db_cleanup_frequency == 'weekly' else '' }}>每周</option>
                                            <option value="monthly" {{ 'selected' if settings.db_cleanup_frequency == 'monthly' else '' }}>每月</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="flex items-center">
                                    <input type="checkbox" name="auto_update" {{ 'checked' if settings.auto_update else '' }} class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                    <label class="ml-2 block text-sm text-gray-900">自动更新</label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 备份恢复 -->
                <div id="backup-tab" class="settings-tab hidden">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-gray-500 to-gray-700">
                            <h3 class="text-lg font-semibold text-white">备份恢复</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">自动备份频率</label>
                                        <select name="backup_frequency" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="disabled" {{ 'selected' if settings.backup_frequency == 'disabled' else '' }}>禁用</option>
                                            <option value="daily" {{ 'selected' if settings.backup_frequency == 'daily' else '' }}>每日</option>
                                            <option value="weekly" {{ 'selected' if settings.backup_frequency == 'weekly' else '' }}>每周</option>
                                            <option value="monthly" {{ 'selected' if settings.backup_frequency == 'monthly' else '' }}>每月</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">备份保留数量</label>
                                        <input type="number" name="backup_retention_count" value="{{ settings.backup_retention_count or 7 }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">备份路径</label>
                                    <input type="text" name="backup_path" value="{{ settings.backup_path or './backups' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="flex space-x-4">
                                    <button type="button" onclick="createBackup()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                                        <i class="fas fa-save mr-2"></i>
                                        立即备份
                                    </button>
                                    <button type="button" onclick="restoreBackup()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200">
                                        <i class="fas fa-upload mr-2"></i>
                                        恢复备份
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.settings-nav-item {
    color: #6b7280;
}

.settings-nav-item:hover {
    background-color: #f3f4f6;
    color: #374151;
}

.settings-nav-item.active {
    background-color: #3b82f6;
    color: white;
}

.settings-tab {
    display: block;
}

.settings-tab.hidden {
    display: none;
}
</style>

<script>
function showSettingsTab(tabName) {
    // 隐藏所有标签页
    const tabs = document.querySelectorAll('.settings-tab');
    tabs.forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // 显示选中的标签页
    const selectedTab = document.getElementById(tabName + '-tab');
    if (selectedTab) {
        selectedTab.classList.remove('hidden');
    }
    
    // 更新导航状态
    const navItems = document.querySelectorAll('.settings-nav-item');
    navItems.forEach(item => {
        item.classList.remove('active');
    });
    
    const activeNavItem = document.querySelector(`[href="#${tabName}"]`);
    if (activeNavItem) {
        activeNavItem.classList.add('active');
    }
}

function saveAllSettings() {
    const forms = document.querySelectorAll('form[id$="-settings-form"]');
    const allSettings = {};
    
    forms.forEach(form => {
        const formData = new FormData(form);
        for (let [key, value] of formData.entries()) {
            allSettings[key] = value;
        }
    });
    
    fetch('/api/settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(allSettings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('设置保存成功', 'success');
        } else {
            showNotification('设置保存失败: ' + data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('设置保存失败', 'error');
    });
}

function resetToDefaults() {
    if (confirm('确定要恢复所有设置到默认值吗？此操作不可撤销。')) {
        fetch('/api/settings/reset', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('设置已恢复到默认值', 'success');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            } else {
                showNotification('恢复默认设置失败: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('恢复默认设置失败', 'error');
        });
    }
}

function exportSettings() {
    fetch('/api/settings/export')
    .then(response => response.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'settings_' + new Date().toISOString().slice(0, 10) + '.json';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        showNotification('设置导出成功', 'success');
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('设置导出失败', 'error');
    });
}

function createBackup() {
    fetch('/api/backup/create', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('备份创建成功', 'success');
        } else {
            showNotification('备份创建失败: ' + data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('备份创建失败', 'error');
    });
}

function restoreBackup() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.zip,.tar.gz';
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (file) {
            const formData = new FormData();
            formData.append('backup_file', file);
            
            fetch('/api/backup/restore', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('备份恢复成功', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } else {
                    showNotification('备份恢复失败: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('备份恢复失败', 'error');
            });
        }
    };
    input.click();
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-md shadow-lg z-50 ${
        type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    // 默认显示常规设置
    showSettingsTab('general');
});
</script>
{% endblock %}