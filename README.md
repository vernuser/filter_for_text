# txt_filter 🚀

一个课程设计项目（课设），主要由 AI 辅助完成与优化。系统针对文本、URL、IP 等内容进行安全分析与过滤，并具备一定的“自学习”能力以持续提升识别效果。

## 功能亮点 ✨
- 🔍 内容分析：统一接口对文本/URL/IP 的恶意性进行判定，并返回置信度与特征信息。
- 🧠 机器学习：
  - 文本采用 TF‑IDF 特征，候选模型为随机森林 / SVM / 朴素贝叶斯，自动选择验证集表现最佳者。
  - URL 使用手工特征（长度、特殊字符计数、HTTPS、短链、是否包含IP/非常用端口等）+ 随机森林。
- ♻️ 自学习：预测结果与用户反馈会回灌到训练样本与特征库（包含自学习关键词），迭代提升模型效果。
- 🌐 Web 界面：登录、仪表盘、集成测试页 `/smoke`，支持自定义输入测试；提供实时日志与状态查看。
- 🗄️ 数据库兼容：支持 SQLite/MySQL，包含去重、唯一键与迁移逻辑（避免重复样本与并发冲突）。

## 快速上手 🛠️
```bash
python run_fairy_ui.py
# 可选：设置环境变量（Windows PowerShell 示例）
$env:FAIRY_HOST='127.0.0.1'
$env:FAIRY_PORT='8000'
$env:FAIRY_DEBUG='1'
```
- 访问 `http://127.0.0.1:8000/` 登录进入仪表盘。
- 打开 `/smoke` 页面：一键运行集成测试、或在同页进行自定义分析（文本/URL/IP）。

## API 速览 📡
- `POST /api/analyze`
  - 请求体：`{ type: 'text' | 'url' | 'ip', content: string }`
  - 响应示例：
    ```json
    {
      "success": true,
      "result": {
        "is_malicious": true,
        "confidence": 0.87,
        "features": { "url_length": 83, "has_ip": 1, ... },
        "sensitive_types": [{"category":"凭据泄露","severity":"high"}]
      }
    }
    ```
- `/smoke`：Web 测试页（启动脚本、实时日志、输入自测）。

## 目录结构 🗂️
- `core/`：数据库管理、黑名单更新、过滤引擎、通用后端模块
- `ml/`：机器学习引擎与特征提取、训练/预测、自学习关键词更新
- `ui/`：Flask 应用、模板与静态资源（登录/仪表盘/测试页等）
- `scripts/`：集成测试脚本与接口快速测试
- `security/`：安全与完整性检查
- `extensions/`：扩展能力（时间控制等）
- `data/`：SQLite 数据库、模型与特征文件（演示数据）

## 关键技术 🧩
- 后端：Flask
- ML：scikit‑learn（TF‑IDF、随机森林、SVM、朴素贝叶斯）、轻量 MLP 可选类
- 数据库：SQLite / MySQL（含占位符兼容与表迁移）
- 前端：HTML/CSS/JS（仪表盘与测试交互）

## 环境变量 ⚙️
- `FAIRY_HOST` / `FAIRY_PORT` / `FAIRY_DEBUG`：服务监听与调试开关。
- `FAIRY_AUTH_DB`：覆盖认证数据库路径，便于测试时隔离锁表影响。
- 可按需扩展，保持默认即可运行。

## 常见问题 ❓
- 大文件提醒：仓库包含部分构建产物或二进制文件（如 `build/` 内文件）体积较大，建议按需启用 Git LFS 或在 `.gitignore` 中忽略不必要的产物。
- 数据库锁：SQLite 并发写入可能锁表；系统在关键写入处做了兼容与回退，生产环境建议使用 MySQL。
- 训练样本不足：默认需要不少于 100 条样本才触发训练；也可调用训练接口/命令进行强制训练。

## 致谢与声明 📝
- 该项目为课程设计（课设），大部分由 AI 辅助完成代码与文档；在此基础上做了人工检查与修正。
- 为保护隐私与简化演示，`jieshao.md` 不随仓库提交；项目说明请以本 README 为准。

## 许可 📄
- 仅用于课程学习与演示，未设置开源许可证。如需开源或复用，请先补充许可证并进行适配。
